{
	"info": {
		"_postman_id": "6982b186-3419-49ea-ba0a-f49e244f8738",
		"name": "Ipswich JAFFA Results API Tests",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "1305764"
	},
	"item": [
		{
			"name": "V2",
			"item": [
				{
					"name": "Categories",
					"item": [
						{
							"name": "Read categories",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/categories",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"categories"
									]
								},
								"description": "Get events"
							},
							"response": []
						}
					]
				},
				{
					"name": "CourseTypes",
					"item": [
						{
							"name": "Read course types",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/coursetypes",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"coursetypes"
									]
								},
								"description": "Get events"
							},
							"response": []
						}
					]
				},
				{
					"name": "Distances",
					"item": [
						{
							"name": "Read distances",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"pm.globals.set(\"schema\", pm.globals.get(\"distanceReadSchema\"));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/distances",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"distances"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						}
					]
				},
				{
					"name": "Events",
					"item": [
						{
							"name": "Read events",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/events",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"events"
									]
								},
								"description": "Get events"
							},
							"response": []
						},
						{
							"name": "Read event top attendees",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/events/203/topAttendees",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"events",
										"203",
										"topAttendees"
									]
								},
								"description": "Get events"
							},
							"response": []
						},
						{
							"name": "Read event insights",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/events/203/insights",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"events",
										"203",
										"insights"
									]
								},
								"description": "Get events"
							},
							"response": []
						},
						{
							"name": "Create event",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"var jsonData = pm.response.json();    \r",
											"pm.environment.set(\"eventId\", jsonData.id);"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");",
											"",
											"// Reset eventId in event of failure",
											"pm.environment.unset(\"eventId\");",
											"",
											"//Evaluate the script to login to WP that is stored as an environment variable.",
											"eval(pm.variables.get(\"executeLoginRequest\"));",
											"",
											"executeLoginRequest();"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{loginToken}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"event\": {\n        \"name\": \"Test event. To be deleted.\",\n        \"website\": \"www.test.co.uk\"\n    }\n}"
								},
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/events",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"events"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Update event - invalid change",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 400\", function () {\r",
											"    pm.response.to.have.status(400);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");",
											"",
											"if (pm.environment.get(\"eventId\")) {",
											"    //Evaluate the script to login to WP that is stored as an environment variable.",
											"    eval(pm.variables.get(\"executeLoginRequest\"));",
											"",
											"    executeLoginRequest();",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{loginToken}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n \"field\" : \"invalid\",\n \"value\" : \"I should not change\"\n}"
								},
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/events/{{eventId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"events",
										"{{eventId}}"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Delete event",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.environment.unset(\"eventId\");"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");",
											"",
											"if (pm.environment.get(\"eventId\")) {",
											"    //Evaluate the script to login to WP that is stored as an environment variable.",
											"    eval(pm.variables.get(\"executeLoginRequest\"));",
											"",
											"    executeLoginRequest();",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{loginToken}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"value": "application/json",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/events/{{eventId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"events",
										"{{eventId}}"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						}
					]
				},
				{
					"name": "Genders",
					"item": [
						{
							"name": "Read genders",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/genders",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"genders"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						}
					]
				},
				{
					"name": "GrandPrix",
					"item": [
						{
							"name": "Read Grand Prix scores",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/results/grandPrix/2018/2",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"results",
										"grandPrix",
										"2018",
										"2"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						}
					]
				},
				{
					"name": "HistoricRecords",
					"item": [
						{
							"name": "Read historic club records by distance",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/results/historicrecords/distance/1",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"results",
										"historicrecords",
										"distance",
										"1"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Read historic club records by category",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/results/historicrecords/category/1",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"results",
										"historicrecords",
										"category",
										"1"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						}
					]
				},
				{
					"name": "Leagues",
					"item": [
						{
							"name": "Read leagues",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/leagues",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"leagues"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Read league races",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/leagues/32",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"leagues",
										"32"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Create league",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");",
											"",
											"var loginToken = pm.environment.get(\"loginToken\");",
											"console.log(\"loginToken: \" +pm.environment.get('loginToken'));",
											"",
											"if (loginToken) {",
											"    // Validate current Token - do we need to login?",
											"    pm.sendRequest({",
											"        url: pm.environment.get(\"protocol\")+\"://\"+pm.environment.get(\"host\")+\"/wp-json/jwt-auth/v1/token/validate\",",
											"        method: 'POST',",
											"        header: {",
											"            \"Authorization\": \"Bearer \" + loginToken,",
											"            \"content-type\": \"application/json\",",
											"        }",
											"    }, function (error, response) {",
											"        if (error) {",
											"            console.log(\"Token validation error: \" + error);",
											"            postman.setNextRequest(null);",
											"        } else if (response.code != 200) {",
											"            console.log(\"Token validation failed: \" + response.json());",
											"            postman.setNextRequest(null);",
											"        } else {",
											"            console.log(\"Token validation passed.\");",
											"        }",
											"    });",
											"}",
											"",
											"if (!loginToken) {",
											"    // Login and set Bearer Token",
											"    pm.sendRequest({",
											"        url: pm.environment.get(\"protocol\")+\"://\"+pm.environment.get(\"host\")+\"/wp-json/jwt-auth/v1/token\",",
											"        method: 'POST',",
											"        header: {",
											"            'content-type': 'application/json',",
											"        },",
											"        body: {",
											"            mode: 'raw',",
											"            raw: JSON.stringify({ 'username': pm.environment.get(\"username\"), 'password': pm.environment.get(\"password\") })",
											"        }",
											"    }, function (error, response) {",
											"        if (error) {",
											"            console.log(\"Login request error: \" + error);",
											"            postman.setNextRequest(null);",
											"        } else if (response.code != 200) {",
											"            console.log(\"Login request failed: \" + res.json());",
											"            postman.setNextRequest(null);",
											"        } else {",
											"            console.log(\"Login request passed. Setting authorization bearer token: \" + response.json().token);",
											"            pm.environment.set(\"loginToken\", response.json().token);",
											"        }",
											"    });",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{loginToken}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n\t\"league\" : {\n\t\t\"name\" : \"53-12 Cross-country League\",\n\t\t\"startingYear\" : 2009,\n\t\t\"courseTypeId\" : 5\n\t}\n}"
								},
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/leagues",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"leagues"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Update league - name",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");",
											"",
											"if (pm.environment.get(\"leagueId\")) {",
											"    //Evaluate the script to login to WP that is stored as an environment variable.",
											"    eval(pm.variables.get(\"executeLoginRequest\"));",
											"",
											"    executeLoginRequest();",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{loginToken}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n \"field\" : \"name\",\n \"value\" : \"Test League - to be deleted. Updated.\"\n}"
								},
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/leagues/{{leagueId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"leagues",
										"{{leagueId}}"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Delete league",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.environment.unset(\"leagueId\");"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");",
											"",
											"if (pm.environment.get(\"leagueId\")) {",
											"    //Evaluate the script to login to WP that is stored as an environment variable.",
											"    eval(pm.variables.get(\"executeLoginRequest\"));",
											"",
											"    executeLoginRequest();",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{loginToken}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"value": "application/json",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/leagues/{{leagueId}}?deleteRaceAssociations=false",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"leagues",
										"{{leagueId}}"
									],
									"query": [
										{
											"key": "deleteRaceAssociations",
											"value": "false"
										}
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						}
					]
				},
				{
					"name": "Rankings",
					"item": [
						{
							"name": "Read result rankings by distance",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/results/ranking/distance/1?year=2019&sexId=2&categoryId=1",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"results",
										"ranking",
										"distance",
										"1"
									],
									"query": [
										{
											"key": "year",
											"value": "2019"
										},
										{
											"key": "sexId",
											"value": "2"
										},
										{
											"key": "categoryId",
											"value": "1"
										}
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Read average percentage rankings",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/results/ranking/averageWMA?sexId=2&numberOfRaces=5&year=2019",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"results",
										"ranking",
										"averageWMA"
									],
									"query": [
										{
											"key": "sexId",
											"value": "2"
										},
										{
											"key": "numberOfRaces",
											"value": "5"
										},
										{
											"key": "year",
											"value": "2019"
										}
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Read WMA percentage rankings",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/results/ranking/wma?sexId=2&distanceId=1&year=2019&distinct=true",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"results",
										"ranking",
										"wma"
									],
									"query": [
										{
											"key": "sexId",
											"value": "2"
										},
										{
											"key": "distanceId",
											"value": "1"
										},
										{
											"key": "year",
											"value": "2019"
										},
										{
											"key": "distinct",
											"value": "true"
										}
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						}
					]
				},
				{
					"name": "Records",
					"item": [
						{
							"name": "Read overall club records",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/results/historicrecords/distance/1",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"results",
										"historicrecords",
										"distance",
										"1"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Read top individual records holders",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/results/records/holders",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"results",
										"records",
										"holders"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Read club records by distance",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/results/records/distance/1",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"results",
										"records",
										"distance",
										"1"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						}
					]
				},
				{
					"name": "Runners",
					"item": [
						{
							"name": "Read runners (logged out)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Date of birth is not returned for logged out users.\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    pm.expect(jsonData[0].dateOfBirth).to.equal(undefined);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"pm.globals.set(\"schema\", pm.globals.get(\"runnerReadSchema\"));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/runners",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"runners"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Read runners (logged in)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Date of birth is returned for logged in users with correct permissions.\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    pm.expect(jsonData[0].dateOfBirth).not.equal(null);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");\r",
											"\r",
											"//Evaluate the script to login to WP that is stored as an environment variable.\r",
											"eval(pm.variables.get(\"executeLoginRequest\"));\r",
											"\r",
											"executeLoginRequest();"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{loginToken}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/runners",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"runners"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Save runner",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");\r",
											"\r",
											"// Reset eventId in event of failure\r",
											"pm.environment.unset(\"runnerId\");\r",
											"\r",
											"//Evaluate the script to login to WP that is stored as an environment variable.\r",
											"eval(pm.variables.get(\"executeLoginRequest\"));\r",
											"\r",
											"executeLoginRequest();"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"var jsonData = pm.response.json();    \r",
											"pm.environment.set(\"runnerId\", jsonData.id);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{loginToken}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"runner\":{\"name\":\"zzz Test entry\",\"sexId\":\"2\",\"dateOfBirth\":\"1950-01-01\"}}"
								},
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/runners",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"runners"
									]
								},
								"description": "Add runners. Tested."
							},
							"response": []
						},
						{
							"name": "Update runner - name",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");",
											"",
											"if (pm.environment.get(\"eventId\")) {",
											"    //Evaluate the script to login to WP that is stored as an environment variable.",
											"    eval(pm.variables.get(\"executeLoginRequest\"));",
											"",
											"    executeLoginRequest();",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{loginToken}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n \"field\" : \"name\",\n \"value\" : \"Test name changed\"\n}"
								},
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/events/{{eventId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"events",
										"{{eventId}}"
									]
								},
								"description": "Get distances. Tested."
							},
							"response": []
						},
						{
							"name": "Delete runner",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation\r",
											"pm.globals.unset(\"schema\");\r",
											"\r",
											"if (pm.environment.get(\"runnerId\")) {\r",
											"    //Evaluate the script to login to WP that is stored as an environment variable.\r",
											"    eval(pm.variables.get(\"executeLoginRequest\"));\r",
											"\r",
											"    executeLoginRequest();\r",
											"}"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.environment.unset(\"runnerId\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{loginToken}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/runners/{{runnerId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"runners",
										"{{runnerId}}"
									]
								},
								"description": "Delete a runner. Tests when no results and with results :)"
							},
							"response": []
						}
					]
				},
				{
					"name": "RunnerOfTheMonth",
					"item": []
				},
				{
					"name": "Statistics",
					"item": [
						{
							"name": "Read statistics: Yearly county results count",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/statistics/type/1",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"statistics",
										"type",
										"1"
									]
								}
							},
							"response": []
						},
						{
							"name": "Read statistics: Yearly country results count",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/statistics/type/2",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"statistics",
										"type",
										"2"
									]
								}
							},
							"response": []
						},
						{
							"name": "Read statistics: Yearly results count",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/statistics/type/3",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"statistics",
										"type",
										"3"
									]
								}
							},
							"response": []
						},
						{
							"name": "Read statistics: Peronsal Best leaders",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/statistics/type/4",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"statistics",
										"type",
										"4"
									]
								}
							},
							"response": []
						},
						{
							"name": "Read statistics: Event with most results",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/statistics/type/6",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"statistics",
										"type",
										"6"
									]
								}
							},
							"response": []
						},
						{
							"name": "Read statistics: Runners with most results",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/statistics/type/7",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"statistics",
										"type",
										"7"
									]
								}
							},
							"response": []
						},
						{
							"name": "Read statistics: Runners with most results in a year",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// No schema - no validation",
											"pm.globals.unset(\"schema\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{protocol}}://{{host}}/wp-json/ipswich-jaffa-api/v2/statistics/type/8",
									"protocol": "{{protocol}}",
									"host": [
										"{{host}}"
									],
									"path": [
										"wp-json",
										"ipswich-jaffa-api",
										"v2",
										"statistics",
										"type",
										"8"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "TeamResults",
					"item": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"pm.test(\"Status code is 200\", function () {",
					"    pm.response.to.have.status(200);",
					"});",
					"",
					"var schema = pm.globals.get(\"schema\");",
					"if (schema) {",
					"    const schemaJson = JSON.parse(schema);",
					"    ",
					"    pm.test('Schema Validation', function() {",
					"        ",
					"        var result = tv4.validateResult(pm.response.json(), schemaJson);",
					"     ",
					"        if (!result.valid) {",
					"            console.log(result);",
					"        }",
					"     ",
					"        pm.expect(result.valid).to.be.true;",
					"    });",
					"}"
				]
			}
		}
	]
}